<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>WebSocket Test</title>
    <script type="text/javascript">
        var socket;
        if(!window.WebSocket){
            window.WebSocket = window.MozWebsocket
        }
        if(window.WebSocket) {
        socket = new WebSocket("ws://localhost:8888/websocket")  //建立连接

        socket.onmessage = function(event) {
            var ta = document.getElementById('responseContent')
            ta.value += event.data + "\r\n";
        }

        socket.onopen = function(event) {
            var ta = document.getElementById('responseContent')
            ta.value +=  "您当前的浏览器支持websocket，请进行后续操作\r\n"
        }

        socket.onclose = function(event) {
            var ta = document.getElementById('responseContent')
            ta.value +=  ""
            ta.value +=  "websocket连接已经关闭"
        }

        }else{
            alert("您的浏览器不支持webSocket")
        }

        function send() {
            if(!window.WebSocket){
                return
            }

            if(socket.readyState == WebSocket.OPEN) {
                let data = {
                    type: 7,
                    params: {
                            // 用户id
                            userId:124,
                            // 用户名
                            userName:"hhh",
                            // 密码
                            password:1234,
                            // 性别
                            sex:"nan",
                            // 头像路径
                            image:"123465"
                    }
                }
//将json对象转变为json字符串以传输
                socket.send(JSON.stringify(data));
            }else{
                alert("websocket连接没有建立成功...")
            }

        }

        function send2(message) {
            if(!window.WebSocket){
                return
            }

            if(socket.readyState == WebSocket.OPEN) {
                let data = {
                type: 1,
                params: {
                  toMessageId: 123,
                  message: "你好呀",
                  fileType: 0,
                },
                }

//将json对象转变为json字符串以传输
                socket.send(JSON.stringify(data));
            }else{
                alert("websocket连接没有建立成功...")
            }

        }
        
       
    </script>
</head>

<body>
    <form onsubmit="return false;">
        <input type="text" name="message" value = ""/>
        <br></br>
        <input type="button" value="websocket注册" onclick="send()"/>
        <input type="button" value="websocket私聊" onclick="send2(this.form.message.value)"/>
        <h2>客户端接收到服务端返回的应答消息</h2>
        <textarea id = "responseContent" style = "width: 1024px;height: 300px;"></textarea>
    </form>
</body>
</html>
